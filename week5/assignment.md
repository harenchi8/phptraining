
# 第5週 実践課題

この課題では、これまでの知識を総集結させ、CRUD（作成・読み取り・更新・削除）の全機能を備えた「メモアプリ」を構築します。

---

### 事前準備: `memos`テーブルの作成

1.  phpMyAdminで、先週作成した `php_training_db` データベースを選択します。
2.  以下の仕様で `memos` テーブルを新規作成してください。
    *   テーブル名: `memos`
    *   **カラム定義:**
        1.  `id`: `INT`, `AUTO_INCREMENT`, `PRIMARY`
        2.  `content`: `TEXT` (メモの内容を保存するため長文が可能な型)
        3.  `created_at`: `DATETIME`, デフォルト `CURRENT_TIMESTAMP`
        4.  `updated_at`: `DATETIME`, デフォルト `CURRENT_TIMESTAMP`, `ON UPDATE CURRENT_TIMESTAMP` (レコード更新時に自動で現在日時をセットする設定)

---

## 課題1: メモの一覧(Read)と登録(Create)機能 (9/20)

**目的:**
データベースからデータを取得して表示する機能と、フォームから新しいデータを登録する機能を実装します。

**構成ファイル:**
- `index.php` (一覧画面 兼 登録フォーム)
- `create.php` (登録処理)
- `db_connect.php` (第4週で作成したものを流用)

**手順:**

1.  **`index.php`** の要件:
    *   `db_connect.php` を読み込みます。
    *   `memos` テーブルから全てのメモを `SELECT` し、`fetchAll` で取得します。
    *   **登録フォーム**: 新しいメモの内容を入力する `<textarea>` と送信ボタンを設置します。送信先は `create.php`、メソッドは `POST` とします。
    *   **一覧表示**: 取得したメモの配列を `foreach` でループし、内容を `<li>` タグなどで一覧表示します。このとき、XSS対策として `htmlspecialchars` を忘れないようにしてください。

2.  **`create.php`** の要件:
    *   `db_connect.php` を読み込みます。
    *   POSTリクエストで送信されたメモの内容 (`content`) を受け取ります。
    *   **バリデーション**: メモの内容が空でないか、また、長すぎないか（例: 1000文字以内）をチェックします。エラーがあれば、エラーメッセージを表示して処理を中断します（今回はシンプルな `die()` でOK）。
    *   プリペアドステートメントを使い、`memos` テーブルに新しいメモを `INSERT` します。
    *   登録が完了したら、`header('Location: index.php');` で一覧画面にリダイレクトします。

**動作確認:**
- `index.php` にアクセスし、フォームが表示されることを確認します。
- メモをいくつか登録し、一覧にリアルタイムで追加されていくことを確認します。
- phpMyAdminでも `memos` テーブルにデータが保存されていることを確認します。

---

## 課題2: メモの編集(Update)と削除(Delete)機能 (9/21)

**目的:**
既存のメモを更新する機能と、不要なメモを削除する機能を追加し、CRUDアプリを完成させます。

**構成ファイル（追加・修正）:**
- `index.php` (修正)
- `edit.php` (編集画面)
- `update.php` (更新処理)
- `delete.php` (削除処理)

**手順:**

1.  **`index.php` の修正**:
    *   メモ一覧を表示する `foreach` ループの中に、各メモに対応する「編集」と「削除」のリンクまたはボタンを追加します。
    *   **編集リンク**: `<a href="edit.php?id=<?= $memo['id'] ?>">編集</a>` のように、GETパラメータでメモのIDを渡します。
    *   **削除ボタン**: `<form action="delete.php" method="post"> ... </form>` を各メモに設置し、`hidden`フィールドでIDを渡します。JavaScriptで削除確認ダイアログ (`onsubmit="return confirm(...)"`) を実装しましょう。

2.  **`edit.php` (編集画面)** の要件:
    *   `db_connect.php` を読み込みます。
    *   `$_GET['id']` で渡されたIDを受け取ります。IDが無効な場合はエラーメッセージを表示して終了します。
    *   受け取ったIDを元に、`memos` テーブルから対象のメモを1件 `SELECT` します。
    *   取得したメモの内容を、`<textarea>` の中に初期値として表示します。
    *   フォームの送信先は `update.php`、メソッドは `POST` とします。
    *   更新対象のIDを `hidden` フィールドで `update.php` に渡すのを忘れないように。

3.  **`update.php` (更新処理)** の要件:
    *   `db_connect.php` を読み込みます。
    *   POSTされたメモの内容 (`content`) とID (`id`) を受け取ります。
    *   バリデーション（空チェックなど）を実装します。
    *   プリペアドステートメントを使い、`UPDATE memos SET content = :content WHERE id = :id` を実行します。
    *   更新が完了したら、`index.php` にリダイレクトします。

4.  **`delete.php` (削除処理)** の要件:
    *   `db_connect.php` を読み込みます。
    *   POSTされたID (`id`) を受け取ります。
    *   プリペアドステートメントを使い、`DELETE FROM memos WHERE id = :id` を実行します。
    *   削除が完了したら、`index.php` にリダイレクトします。

**動作確認:**
- 一覧画面で「編集」リンクをクリックすると、`edit.php` に遷移し、メモの内容がフォームに表示されることを確認します。
- 内容を書き換えて更新すると、一覧画面に反映されることを確認します。
- 「削除」ボタンを押すと確認ダイアログが表示され、「OK」を押すとメモが一覧から消えることを確認します。
- phpMyAdminで、`memos` テーブルのデータが実際に更新・削除されていることを確認します。
